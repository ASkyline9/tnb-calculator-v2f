<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TNB Electricity Cost Calculator</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="assets/favicon-32x32.png" sizes="32x32">

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4071724251256256" crossorigin="anonymous"></script>
    
</head>
<body>
    <div class="app-container">
        <header>
            <img src="assets/favicon-64x64.png" alt="TNB Logo" class="logo">
            <h1>TNB Electricity Cost Calculator</h1>
            <p class="subtitle">Quickly Calculate Your Electricity Cost in Malaysia</p>
        </header>

        <div class="ad-container">
            <ins class="adsbygoogle"
                style="display:block"
                data-ad-client="ca-pub-4071724251256256"
                data-ad-slot="YOUR_AD_SLOT_ID"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>

        <main>
            <div class="card">
                <form id="calcForm">
                    <div class="form-group">
                        <label for="amp">Current</label>
                        <div class="input-wrapper">
                            <input type="number" step="0.01" id="amp" placeholder="e.g. 6.8" required>
                            <span>Amps</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="voltage">Voltage</label>
                        <div class="input-wrapper">
                            <input type="number" step="1" id="voltage" value="240" required>
                            <span>Volts</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="minutes">Usage Duration</label>
                        <div class="input-wrapper">
                            <input type="number" step="1" id="minutes" placeholder="e.g. 45" required>
                            <span>Minutes</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="rate">TNB Rate (RM0.27 July 2025)</label>
                        <div class="input-wrapper">
                            <input type="number" step="0.001" id="rate" value="0.27" required>
                            <span>RM/kWh</span>
                        </div>
                    </div>
                    <button type="submit" class="btn">Calculate Cost</button>
                </form>
            </div>

            <div class="card result-box hidden" id="resultBox">
                <p id="resultText"></p>
            </div>
            
            <div class="card history">
                <h2>Calculation History</h2>
                <div class="table-container">
                    <table id="historyTable">
                        <thead>
                            <tr>
                                <th>Amp</th>
                                <th>Mins</th>
                                <th>Rate</th>
                                <th>Volt</th>
                                <th>Cost (RM)</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="history-buttons">
                    <button id="clearHistoryBtn">Clear History</button>
                </div>
            </div>

            <a href="https://s.shopee.com.my/4L9U1n1WuH" target="_blank" style="text-decoration: none;">
    <div style="background-color: #EE4D2D; color: white; padding: 15px; text-align: center; border-radius: 8px; margin-top: 20px; font-weight: bold; font-size: 1.1em;">
        Appliances Tester (Current Measurement) on Shopee
    </div>
</a>
        </main>

        <footer>
            <a href="https://github.com/askyline9/tnb-calculator-v2f/blob/main/README.md" target="_blank" rel="noopener noreferrer" class="footer-link">About This App</a>
            <button id="installBtn" class="hidden">Install App</button>
            <p class="dev-info">Developed by aa.skyline99@gmail.com</p>
            <p>Design assisted by Gemini</p>
            <p>&copy; 2025 Version 2.0.0 | 21 August 2025</p>
            <p>All Rights Reserved</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('calcForm');
            const resultBox = document.getElementById('resultBox');
            const resultText = document.getElementById('resultText');
            const historyTable = document.querySelector('#historyTable tbody');
            const clearHistoryBtn = document.getElementById('clearHistoryBtn');
            const installBtn = document.getElementById('installBtn');
            const MAX_HISTORY = 10;

            // Calculator logic
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                const amp = parseFloat(document.getElementById('amp').value);
                const minutes = parseFloat(document.getElementById('minutes').value);
                const rate = parseFloat(document.getElementById('rate').value);
                const voltage = parseFloat(document.getElementById('voltage').value);

                if (isNaN(amp) || isNaN(minutes) || isNaN(rate) || isNaN(voltage)) {
                    alert("Please fill in all fields with valid numbers.");
                    return;
                }

                const powerKw = (amp * voltage) / 1000;
                const hours = minutes / 60;
                const cost = powerKw * hours * rate;

                resultText.innerHTML = `Estimated Cost: <strong>RM ${cost.toFixed(2)}</strong>`;
                resultBox.classList.remove('hidden');
                resultBox.scrollIntoView({ behavior: 'smooth' });

                addToHistory(amp, minutes, rate, voltage, cost);
            });

            function addToHistory(amp, minutes, rate, voltage, cost) {
                const history = JSON.parse(localStorage.getItem('calcHistory')) || [];
                const newEntry = { amp, minutes, rate, voltage, cost: cost.toFixed(2) };
                
                // Add the new entry to the start of the array
                history.unshift(newEntry);
                
                // Keep only the 10 most recent entries
                if (history.length > MAX_HISTORY) {
                    history.pop();
                }

                localStorage.setItem('calcHistory', JSON.stringify(history));
                renderHistory();
            }

            function renderHistory() {
                const history = JSON.parse(localStorage.getItem('calcHistory')) || [];
                historyTable.innerHTML = ''; // Clear the current table

                history.forEach(entry => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${entry.amp}</td>
                        <td>${entry.minutes}</td>
                        <td>${entry.rate}</td>
                        <td>${entry.voltage}</td>
                        <td><strong>${entry.cost}</strong></td>
                    `;
                    historyTable.appendChild(row);
                });
            }

            function clearHistory() {
                localStorage.removeItem('calcHistory');
                renderHistory();
            }

            clearHistoryBtn.addEventListener('click', clearHistory);
            
            // PWA Install Button logic
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                installBtn.classList.remove('hidden');
            });

            installBtn.addEventListener('click', () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then(() => {
                        deferredPrompt = null;
                        installBtn.classList.add('hidden');
                    });
                }
            });

            // Load history on initial page load
            renderHistory();
        });
    </script>
</body>
</html>